<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signage Player</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }

        #container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .media-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* or contain */
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 0;
        }

        .active {
            opacity: 1;
            z-index: 1;
        }

        #loading {
            color: #fff;
            font-family: sans-serif;
            font-size: 2rem;
            z-index: 10;
        }
    </style>
</head>

<body>

    <div id="container">
        <div id="loading">Loading content...</div>
        <!-- Media elements will be injected here or managed here -->
    </div>

    <div id="overlay">
        <h1 id="title"></h1>
        <p id="description"></p>
    </div>

    <div id="screensaver"
        style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; background: black;">
    </div>

    <div id="debug-console"
        style="position: fixed; bottom: 0; right: 0; width: 50%; height: 200px; background: rgba(0,0,0,0.8); color: lime; overflow-y: scroll; z-index: 10000; font-family: monospace; font-size: 12px; padding: 10px; pointer-events: none;">
        Debug Console:<br>
    </div>

    <script>
        const debugConsole = document.getElementById('debug-console');
        function logToScreen(msg, type = 'info') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : 'lime';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            debugConsole.appendChild(div);
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }

        // Wrap console methods
        const originalLog = console.log;
        const originalError = console.error;
        console.log = (...args) => { originalLog(...args); logToScreen(args.join(' ')); };
        console.error = (...args) => { originalError(...args); logToScreen(args.join(' '), 'error'); };

        window.onerror = function (msg, url, lineNo, columnNo, error) {
            logToScreen(`Uncaught Error: ${msg} at line ${lineNo}`, 'error');
            return false;
        };

        console.log("Debug console started.");
    </script>

    <script>
        // ... (existing variable declarations) ...
        const container = document.getElementById('container');
        const loading = document.getElementById('loading');
        const screensaverEl = document.getElementById('screensaver');
        const overlay = document.getElementById('overlay');
        const titleEl = document.getElementById('title');
        const descEl = document.getElementById('description');

        // ... (loadSettings, applySettings, helper functions remain same) ...

        async function playLoop() {
            // ... (fetching playlist logic remains same) ...

            // Logic to cycle
            if (currentIndex >= playlist.length) {
                currentIndex = 0;
            }

            const item = playlist[currentIndex];
            const nextIndex = (currentIndex + 1) % playlist.length;

            const el = createMediaElement(item);
            el.classList.add('active');
            container.innerHTML = '';
            container.appendChild(el);

            // Update Overlay Content (overlay is now outside, so separate z-index management handled in CSS)
            if (item.title || item.description) {
                titleEl.textContent = item.title || "";
                descEl.textContent = item.description || "";
                overlay.style.display = 'block';
            } else {
                overlay.style.display = 'none';
            }

            // ... (rest of timing logic) ...


            // Calculate Duration
            let duration = (item.duration || 10) * 1000;

            if (item.type === 'video') {
                // Wait for video end
                await new Promise(resolve => {
                    el.onended = resolve;
                    el.onerror = resolve;
                });
            } else {
                await wait(duration);
            }

            currentIndex++;
            playLoop();
        }

        // Start
        playLoop();

    </script>
</body>

</html>